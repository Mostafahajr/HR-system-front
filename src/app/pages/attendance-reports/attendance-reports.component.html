<app-breadcrumbs></app-breadcrumbs>

@if(isAddNewAttendancesRoute()){
<div class="container">
  <div class="d-flex">
    <div class="controllers">
      <mat-form-field appearance="outline" class="">
        <mat-label>Filter</mat-label>
        <input
          matInput
          (keyup)="applyFilter($event)"
          placeholder="Ex. Mia"
          #input
        />
      </mat-form-field>

      <mat-form-field appearance="outline" class="">
        <mat-label>Start Date</mat-label>
        <input matInput [matDatepicker]="startPicker" [(ngModel)]="startDate" />
        <mat-datepicker-toggle
          matSuffix
          [for]="startPicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="">
        <mat-label>End Date</mat-label>
        <input matInput [matDatepicker]="endPicker" [(ngModel)]="endDate" />
        <mat-datepicker-toggle
          matSuffix
          [for]="endPicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
      </mat-form-field>
    </div>

    <button mat-stroked-button (click)="applyDateFilter()" class="btn">
      Filter
    </button>
  </div>
  <div class="mat-elevation-z8">
    <div class="scrollable-table">
      <table mat-table [dataSource]="filteredDataSource" matSort>
        <!-- ID Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="w-100">
            <p>ID</p>
          </th>
          <td mat-cell *matCellDef="let row">{{ row.id }}</td>
        </ng-container>
        <!-- department Column -->
        <ng-container matColumnDef="department">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="w-100">
            <p>department</p>
          </th>
          <td mat-cell *matCellDef="let row">{{ row.department }}</td>
        </ng-container>
        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="w-100">
            <p>Name</p>
          </th>
          <td mat-cell *matCellDef="let row">{{ row.name }}</td>
        </ng-container>
        <!-- arrival Column -->
        <ng-container matColumnDef="arrival">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="w-100">
            <p>arrival</p>
          </th>
          <td mat-cell *matCellDef="let row">
            @if (isUpdated && row.id == updatedUserId) {
            <mat-form-field class="w-time" appearance="outline">
              <input matInput type="time" [(ngModel)]="updateArrival" />
              <mat-icon on matSuffix>access_time</mat-icon>
            </mat-form-field>
            }@else {
            <p class="x-time">{{ row.arrival_time }}</p>
            }
          </td>
        </ng-container>
        <!-- leave Column -->
        <ng-container matColumnDef="leave">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="w-100">
            <p>leave</p>
          </th>
          <td mat-cell *matCellDef="let row">
            @if (isUpdated && row.id == updatedUserId) {
            <mat-form-field class="w-time" appearance="outline">
              <input matInput type="time" [(ngModel)]="updateLeave" />
              <mat-icon matSuffix>access_time</mat-icon>
            </mat-form-field>
            }@else {
            <div class="x-time">{{ row.leave_time }}</div>
            }
          </td>
        </ng-container>
        <!-- Date column -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="w-100">
            <p>Date</p>
          </th>
          <td mat-cell *matCellDef="let row">{{ row.date }}</td>
        </ng-container>
        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef mat-sort-header class="w-100">
            <p>Actions</p>
          </th>
          <td mat-cell *matCellDef="let row">
            <div class="button-container">
              @if (isUpdated && row.id == updatedUserId) {
              <button
                mat-icon-button
                class="custom-icon-button edit-button"
                (click)="
                  updateRecord(
                    row.id,
                    row.name,
                    row.department,
                    row.date,
                    row.employee_id
                  )
                "
              >
                <mat-icon>save</mat-icon>
              </button>
              <button
                mat-icon-button
                class="custom-icon-button delete-button"
                (click)="closeUpdate()"
              >
                <mat-icon>close</mat-icon>
              </button>
              }@else {
              <button
                mat-icon-button
                class="custom-icon-button edit-button"
                (click)="editUser(row.id)"
              >
                <mat-icon>edit</mat-icon>
              </button>
              <button
                mat-icon-button
                class="custom-icon-button delete-button"
                (click)="deleteUser(row)"
              >
                <mat-icon>delete</mat-icon>
              </button>
              }
            </div>
          </td>
        </ng-container>
        <tr
          mat-header-row
          *matHeaderRowDef="displayedColumns; sticky: true"
        ></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          [class]="'p'"
        ></tr>
        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">
            No data matching the filter "{{ input.value }}"
          </td>
        </tr>
      </table>
    </div>
    <mat-paginator
      [pageSizeOptions]="[5, 10, 20]"
      aria-label="Select page of users"
    ></mat-paginator>
  </div>
</div>
}
<router-outlet></router-outlet>
